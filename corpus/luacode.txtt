========================
directlua
=======================
\directlua{
  texio.write_nl("Special chars: _ ^ & $ { } working.\string\n"
  .. "Backslashes need a bit of care.\string\n"
  .. "Sharps and tildes too: # doubled, but \string# and \string~")
  % a tex comment: no easy way to get a %
  tex.sprint("\string\\pi \string\\neq", tostring(math.pi))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
---------------------------
(document
  (lua
    (cs)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (text)
      (cs)
      (active_char)
      (text (comment))
      (cs)
      (escaped)
      (text)
      (cs)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

========================
directlua with number
=======================
\directlua"7F{
  texio.write_nl("Special chars: _ ^ & $ { } working.\string\n"
  .. "Backslashes need a bit of care.\string\n"
  .. "Sharps and tildes too: # doubled, but \string# and \string~")
  % a tex comment: no easy way to get a %
  tex.sprint("\string\\pi \string\\neq", tostring(math.pi))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
---------------------------
(document
  (lua
    (cs)
    (hexadecimal)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (text)
      (cs)
      (active_char)
      (text (comment))
      (cs)
      (escaped)
      (text)
      (cs)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

========================
latelua
=======================
\latelua{
  texio.write_nl("Special chars: _ ^ & $ { } working.\string\n"
  .. "Backslashes need a bit of care.\string\n"
  .. "Sharps and tildes too: # doubled, but \string# and \string~")
  % a tex comment: no easy way to get a %
  tex.sprint("\string\\pi \string\\neq", tostring(math.pi))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
---------------------------
(document
  (lua
    (cs)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (text)
      (cs)
      (active_char)
      (text (comment))
      (cs)
      (escaped)
      (text)
      (cs)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

========================
latelua with number
=======================
\latelua"7F{
  texio.write_nl("Special chars: _ ^ & $ { } working.\string\n"
  .. "Backslashes need a bit of care.\string\n"
  .. "Sharps and tildes too: # doubled, but \string# and \string~")
  % a tex comment: no easy way to get a %
  tex.sprint("\string\\pi \string\\neq", tostring(math.pi))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
---------------------------
(document
  (lua
    (cs)
    (hexadecimal)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (text)
      (cs)
      (active_char)
      (text (comment))
      (cs)
      (escaped)
      (text)
      (cs)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

========================
luadirect
=======================
\luadirect{
  texio.write_nl("Special chars: _ ^ & $ { } working.\string\n"
  .. "Backslashes need a bit of care.\string\n"
  .. "Sharps and tildes too: # doubled, but \string# and \string~")
  % a tex comment: no easy way to get a %
  tex.sprint("\string\\pi \string\\neq", tostring(math.pi))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
---------------------------
(document
  (luadirect
    (cs)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (text)
      (cs)
      (active_char)
      (text (comment))
      (cs)
      (escaped)
      (text)
      (cs)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

=======================
luaexec
=======================
\luaexec{
  texio.write_nl("Special chars: _ ^ & $ { } ~ working.\string\n"
  .. "Backslashes still need a bit of care.\string\n"
  .. "Single sharps are easier now: \#")
  % a tex comment: we also get a % below
  tex.sprint("\\pi \\neq ", tostring(math.pi):gsub(’\%.’, ’+’))
  % we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
}
----------------------------
(document
  (luaexec
    (cs)
    (group
      (l)
      (text)
      (group (l) (text) (r))
      (text)
      (cs)
      (cs)
      (text)
      (cs)
      (cs)
      (text)
      (escaped)
      (text (comment))
      (escaped)
      (text)
      (escaped)
      (text)
      (escaped)
      (text (comment))
      (cs)
      (text)
      (r))))

=================
luacode environment
===================
\begin{luacode}
  texio.write_nl("Special chars: _ ^ & $ { } ~ # % working.\string\n"
  .. "Only backslashes still need a bit of care.\string\n")
  -- a lua comment: we could use \% below, too
  tex.sprint("\\pi \\neq ", tostring(math.pi):gsub(’%.’, ’+’))
  -- we can use TeX macros
  tex.sprint("-", math.sqrt(\foo))
\end{luacode}
---------------------
(document
  (luacode_env
    (begin (cs) (group (l) (name) (r)))
    (text)
    (group (l) (text) (r))
    (text)
    (cs)
    (cs)
    (text)
    (cs)
    (cs)
    (text)
    (escaped)
    (text)
    (escaped)
    (text)
    (escaped)
    (text)
    (cs)
    (text)
    (end (cs) (group (l) (name) (r)))))


==========================
luacode* environment
==========================
\begin{luacode*}
  texio.write_nl("Special chars: _ ^ & $ { } ~ # % \\ working.\n")
  -- a lua comment: the backlash is doubled as in normal Lua code
  tex.sprint("\\pi \\neq ", tostring(math.pi):gsub(’%.’, ’+’))
  -- no way to use a TeX variable here
\end{luacode*}
-----------------------------
(document
  (luacodestar_env
    (begin
      (cs)
      (group (l) (name) (r)) (eol))
    (lua_text)
    (end (cs)
      (group (l) (name) (r)))))
